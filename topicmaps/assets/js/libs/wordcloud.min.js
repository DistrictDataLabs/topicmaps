!function(){function t(t){function n(t){return t.text}function e(){return"serif"}function r(){return"normal"}function a(t){return Math.sqrt(t.value)}function u(){return 30*(~~(6*Math.random())-3)}function i(){return 1}function o(t,n,e){if(!t.sprite){M.clearRect(0,0,(g<<5)/m,v/m);var r=0,a=0,u=0,i=n.length;for(--e;++e<i;){t=n[e],M.save(),M.font=t.style+" "+t.weight+" "+~~((t.size+1)/m)+"px "+t.font;var o=M.measureText(t.text+"m").width*m,f=t.size<<1;if(t.rotate){var s=Math.sin(t.rotate*d),c=Math.cos(t.rotate*d),l=o*c,h=o*s,y=f*c,x=f*s;o=Math.max(Math.abs(l+x),Math.abs(l-x))+31>>5<<5,f=~~Math.max(Math.abs(h+y),Math.abs(h-y))}else o=o+31>>5<<5;if(f>u&&(u=f),r+o>=g<<5&&(r=0,a+=u,u=0),a+f>=v)break;M.translate((r+(o>>1))/m,(a+(f>>1))/m),t.rotate&&M.rotate(t.rotate*d),M.fillText(t.text,0,0),t.padding&&(M.lineWidth=2*t.padding,M.strokeText(t.text,0,0)),M.restore(),t.width=o,t.height=f,t.xoff=r,t.yoff=a,t.x1=o>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,r+=o}for(var p=M.getImageData(0,0,(g<<5)/m,v/m).data,w=[];--e>=0;)if(t=n[e],t.hasText){for(var o=t.width,b=o>>5,f=t.y1-t.y0,z=0;f*b>z;z++)w[z]=0;if(r=t.xoff,null==r)return;a=t.yoff;for(var I=0,k=-1,T=0;f>T;T++){for(var z=0;o>z;z++){var q=b*T+(z>>5),D=p[(a+T)*(g<<5)+(r+z)<<2]?1<<31-z%32:0;w[q]|=D,I|=D}I?k=T:(t.y0++,f--,T--,a++)}t.y1=t.y0+k,t.sprite=w.slice(0,(t.y1-t.y0)*b)}}}function f(t,n,e){e>>=5;for(var r,a=t.sprite,u=t.width>>5,i=t.x-(u<<4),o=127&i,f=32-o,s=t.y1-t.y0,c=(t.y+t.y0)*e+(i>>5),l=0;s>l;l++){r=0;for(var h=0;u>=h;h++)if((r<<f|(u>h?(r=a[l*u+h])>>>o:0))&n[c+h])return!0;c+=e}return!1}function s(t,n){var e=t[0],r=t[1];n.x+n.x0<e.x&&(e.x=n.x+n.x0),n.y+n.y0<e.y&&(e.y=n.y+n.y0),n.x+n.x1>r.x&&(r.x=n.x+n.x1),n.y+n.y1>r.y&&(r.y=n.y+n.y1)}function c(t,n){return t.x+t.x1>n[0].x&&t.x+t.x0<n[1].x&&t.y+t.y1>n[0].y&&t.y+t.y0<n[1].y}function l(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function h(t){var n=4,e=n*t[0]/t[1],r=0,a=0;return function(t){var u=0>t?-1:1;switch(Math.sqrt(1+4*u*t)-u&3){case 0:r+=e;break;case 1:a+=n;break;case 2:r-=e;break;default:a-=n}return[r,a]}}function y(t){for(var n=[],e=-1;++e<t;)n[e]=0;return n}t.layout.cloud=function w(){function h(t,n,e){for(var r,a,u,i=([{x:0,y:0},{x:x[0],y:x[1]}],n.x),o=n.y,s=Math.sqrt(x[0]*x[0]+x[1]*x[1]),l=I(x),h=S()<.5?1:-1,y=-h;(r=l(y+=h))&&(a=~~r[0],u=~~r[1],!(Math.min(Math.abs(a),Math.abs(u))>=s));)if(n.x=i+a,n.y=o+u,!(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>x[0]||n.y+n.y1>x[1]||e&&f(n,t,x[0])||e&&!c(n,e))){for(var d,g=n.sprite,v=n.width>>5,m=x[0]>>5,M=n.x-(v<<4),p=127&M,w=32-p,b=n.y1-n.y0,z=(n.y+n.y0)*m+(M>>5),k=0;b>k;k++){d=0;for(var T=0;v>=T;T++)t[z+T]|=d<<w|(v>T?(d=g[k*v+T])>>>p:0);z+=m}return delete n.sprite,!0}return!1}var x=[256,256],d=n,g=e,v=a,m=r,M=r,b=u,z=i,I=l,k=[],T=1/0,q=t.dispatch("word","end"),D=null,S=Math.random,w={};return w.start=function(){function t(){for(var t=Date.now();Date.now()-t<T&&++a<r&&D;){var f=i[a];f.x=x[0]*(S()+.5)>>1,f.y=x[1]*(S()+.5)>>1,o(f,i,a),f.hasText&&h(n,f,e)&&(u.push(f),q.word(f),e?s(e,f):e=[{x:f.x+f.x0,y:f.y+f.y0},{x:f.x+f.x1,y:f.y+f.y1}],f.x-=x[0]>>1,f.y-=x[1]>>1)}a>=r&&(w.stop(),q.end(u,e))}var n=y((x[0]>>5)*x[1]),e=null,r=k.length,a=-1,u=[],i=k.map(function(t,n){return t.text=d.call(this,t,n),t.font=g.call(this,t,n),t.style=m.call(this,t,n),t.weight=M.call(this,t,n),t.rotate=b.call(this,t,n),t.size=~~v.call(this,t,n),t.padding=z.call(this,t,n),t}).sort(function(t,n){return n.size-t.size});return D&&clearInterval(D),D=setInterval(t,0),t(),w},w.stop=function(){return D&&(clearInterval(D),D=null),w},w.timeInterval=function(t){return arguments.length?(T=null==t?1/0:t,w):T},w.words=function(t){return arguments.length?(k=t,w):k},w.size=function(t){return arguments.length?(x=[+t[0],+t[1]],w):x},w.font=function(n){return arguments.length?(g=t.functor(n),w):g},w.fontStyle=function(n){return arguments.length?(m=t.functor(n),w):m},w.fontWeight=function(n){return arguments.length?(M=t.functor(n),w):M},w.rotate=function(n){return arguments.length?(b=t.functor(n),w):b},w.text=function(n){return arguments.length?(d=t.functor(n),w):d},w.spiral=function(t){return arguments.length?(I=p[t]||t,w):I},w.fontSize=function(n){return arguments.length?(v=t.functor(n),w):v},w.padding=function(n){return arguments.length?(z=t.functor(n),w):z},w.random=function(t){return arguments.length?(S=t,w):S},t.rebind(w,q,"on")};var x,d=Math.PI/180,g=64,v=2048,m=1;"undefined"!=typeof document?(x=document.createElement("canvas"),x.width=1,x.height=1,m=Math.sqrt(x.getContext("2d").getImageData(0,0,1,1).data.length>>2),x.width=(g<<5)/m,x.height=v/m):x=new Canvas(g<<5,v);var M=x.getContext("2d"),p={archimedean:l,rectangular:h};M.fillStyle=M.strokeStyle="red",M.textAlign="center"}"function"==typeof define&&define.amd?define(["d3"],t):t(this.d3)}();
